
### Schemat logiczny

Aby skonfigurować komunikację do róznych kanałów dobrze jest zacząć od poznania i zrozumienia logiki w jakie sposób zabbix serwer będzie wykonywał taką komunikację.

>**Items** skonfigurowane w szablonie zbierają ciągle dane -> 
  **Trigger** po wykryciu zadeklarowanej reguły wywoła **alarm/powiadomienie** itd -> 
  **Alarm / powiadomienie** sprawdzi czy jest aktywna **akcja (action)** którą ma wykonać, na przykład wysłać powiadomienie do odpowiedniej grupy użytkowników. ->
  **Użytkownicy** w swojej konfiguracji mają skonfigurowane **media** po których następuje komunikacja.



### Mail

Na potrzeby szkolenia skorzystamy z konfiguracji GMAIL. W firmach na pewno będzie istniał serwer pocztowy którego będziemy mogli użyć, więc konfiguracja będzie inna.

Wejdź w Alerts -> Media types i wybierz opcje mail.
Na potrzeby szkolenia użyj przygotowanego konta.
Login: zabbix.szkolenie@gmail.com
Hasło: mucnaafkhkcldwyl

> Aby można było wysyłać powiadomienia przez gmail, na swoim koncie gmail których chcesz dodać musisz w ustawieniach bezpieczeństwa wygenerować hasło aplikacji. 
> 
> https://myaccount.google.com/apppasswords)
> 
> ![[Pasted image 20230619184418.png]]

Konfiguracja maila:
![[Pasted image 20230619184525.png]]

> W etapie konfiguracji systemu monitoringu warto najpierw używać testowego maila. Żeby nie okazało się że z powodu błędu w konfiguracji nagle otrzymamy 100.000 maili. 

**W taki sam sposób skonfigurować można maila z O365**
___
### Slack 
Konfiguracja kanału komunikacji dla aplikacji Slack wymaga trochę większej konfiguracji. 

1. Zacznij od stworzenia kanału na swoim Workspace, np nazwij go #zabbix_alerts
2. Następnie musimy stworzyć aplikację którą będziemy przesyłać dane z zabbix do naszego kanału slack

Wejdź na stronę https://api.slack.com/apps
Wybierz opcje **Create New App**
![[Pasted image 20230619213904.png]]

Wybierz opcje **From Scratch**
![[Pasted image 20230619214003.png]]

Wprowadź nazwę aplikacji i wybierz odpowiedni workspace

![[Pasted image 20230619214049.png]]

Następnie musimy określić kategorie stworzonej aplikacji, wybierz opcje Bots.
![[Pasted image 20230619214207.png]]

Wygeneruj token dla swojej aplikacji (bota)
![[Pasted image 20230619214313.png]]

W sekcji **Bot Token Scopes** przypisz wartość **chat:write**
![[Pasted image 20230619214508.png]]

Pozostało już tylko zainstalować aplikację na swoim workspace. Wybierz do tego opcje **Install to Workspace**
![[Pasted image 20230619214605.png]]

Zweryfikuj uprawnienia aplikacji:
![[Pasted image 20230619214919.png]]
Teraz mamy wygenerowany OAuth Token który jest nam potrzebny do wprowadzenia go do naszego kanału komunikacji w serwerze zabbix.


![[Pasted image 20230619215021.png]]

3. Wejdz w Alerts -> media type i wybierz Slack
![[Pasted image 20230619215150.png]]

Wprowadź  token w miejsce  **bot_token**

4. Włącz kanał komunikacji **Slack**
![[Pasted image 20230619215324.png]]

5. Wejdź w pozycję Test i na potrzeby tego punktu uzupełnij dane:
channel: #zabbix-alerts
event_id: 1
event_source: 1

6. Dodaj na swoim kanale aplikację która stworzyłeś. Ustawienia kanału -> Integrations > add apps 
Powinieneś otrzymać wiadomość testową:
![[Pasted image 20230619215938.png]]

7. W ustawieniach użytkownika dodaj swojemu użytkownikowi kanał komunikacji Slack, w pozycji **Send To** wprowadź nazwę kanału. 
![[Pasted image 20230619220147.png]]

   
___
### Discord 
Na serwerze stwórz kanał na którym chcesz otrzymywać powiadomienia. Wejdź w ustawienia kanału i w sekcji Integracje wygeneruj webhook.

![Zabbix](/grafiki/media_1.png)

> Stwórz globalne macro w sekcji Administration > Macros
> {$ZABBIX.URL}  i przypisz mu wartość adresu swojego serwera zabbix
> ![Zabbix](/grafiki/media_3.png)

Wejdź w konfigurację **media types** i włącz kanał komunikacji discord:
![Zabbix](/grafiki/media_2.png)

Kolejnym krokiem jest przypisanie do użytkownika tego kanału komunikacji.
W sekcji Users -> Users wybierz swojego użytkownika i w zakładce **Media** dodaj kanał komunikacji discord oraz wprowadź adres webhooka. 

![Zabbix](/grafiki/media_4.png)
Ostatnim krokiem jest upewnienie się czy jest włączona akcja odpowiadająca za wysyłanie powiadomień. Dla konta admin jest przygotowana gotowa akcja:

![Zabbix](/grafiki/media_5.png)
___

